# SwipeLP v3 システム仕様書

**作成日**: 2026-02-02  
**対象**: Re:Design アプリ内のスワイプLP生成機能 v3

---

## 1. 概要

SwipeLP v3 は、URLを入力してから最終的な画像生成用プロンプトを得るまでをステップ形式でガイドするシステムである。Progate風の段階的UIで、AI分析 → スライド構成提案 → デザイン選択 → プロンプト生成までを一貫して行う。

---

## 2. ユーザーフロー

| Step | 画面 | 内容 |
|------|------|------|
| 1 | URL入力 | 分析したいLP・競合サイトのURLを入力。プロジェクト作成と同時にAI分析を開始 |
| 2 | AI分析結果 | マーケティング分析（3C・AIDMA等）の結果を表示。次へ進む |
| 3 | 補足情報 | ユーザーが追加で入力したい情報（任意）。次へでスライド構成をAI提案 |
| 4-5 | スライド編集＆プロンプト | スライドの編集・追加・削除、デザイン選択、人物の有無、プロンプト生成 |

### URL

| 用途 | URL |
|------|-----|
| 新規プロジェクト作成 | `/swipe-lp/v3/new` |
| プロジェクト画面 | `/swipe-lp/v3/[projectId]` |
| ライブラリ管理（社内） | `/library/manage` |

---

## 3. ステータス

| ステータス | 説明 |
|------------|------|
| `url_input` | URL入力後、プロジェクト作成直後 |
| `analyzing` | URLのAI分析中 |
| `analysis_done` | 分析完了。Step2（分析結果表示） |
| `supplement_input` | Step3（補足情報入力） |
| `slides_ready` | スライド構成提案済み。Step4（編集・プロンプト） |
| `prompts_ready` | プロンプト生成済み |

---

## 4. データ構造

### 4.1 SwipeLPv3Project

| フィールド | 型 | 説明 |
|------------|-----|------|
| id | UUID | プロジェクトID |
| user_id | UUID | 作成ユーザー |
| input_url | string | 入力URL |
| status | SwipeLPv3Status | 上記ステータス |
| marketing_analysis | JSONB | AIマーケティング分析結果 |
| user_supplement | string? | ユーザー補足情報 |
| slides | SwipeLPv3Slide[] | スライド構成（JSONB） |

### 4.2 SwipeLPv3Slide

| フィールド | 型 | 説明 |
|------------|-----|------|
| id | string | スライドID（UUID） |
| order | number | 表示順 |
| purpose | string | 役割（課題提起/ソリューション/ベネフィット/社会的証明/CTA） |
| message | string | メインメッセージ（キャッチコピー） |
| subMessage | string? | サブメッセージ |
| additionalText | string[]? | 追加テキスト（チェックリスト・キャプション等） |
| emotion | string? | 喚起する感情 |
| selected_template_id | string? | このスライドで選択したデザインテンプレートID |
| excludePerson | boolean? | true=人物なし・動画オーバーレイ用 |
| prompt | string? | 生成されたプロンプト |
| promptGeneratedAt | string? | プロンプト生成日時 |

### 4.3 MarketingAnalysis

| フィールド | 説明 |
|------------|------|
| businessType | ビジネスタイプ |
| target | ターゲット層 |
| painPoints | 痛み・課題リスト |
| solution | ソリューション |
| emotionalTrigger | 感情トリガー |
| framework.threeC | 3C分析（customer, competitor, company） |
| framework.aidma | AIDMA（attention, interest, desire, memory, action） |

### 4.4 PromptTemplate（プロンプトライブラリ）

| フィールド | 型 | 説明 |
|------------|-----|------|
| id | string | テンプレートID |
| name | string | 表示名 |
| sample_image_url | string? | サンプル画像URL |
| base_prompt | string? | 旧仕様のベースプロンプト |
| prompt_text | string? | AI生成プロンプト（新仕様、優先使用） |
| image_urls | string[]? | 参考画像URL一覧 |
| category | string? | カテゴリ（婚活/転職/EC/汎用等） |
| memo | string? | メモ（UGC感/雑誌風等） |

---

## 5. プロンプト生成ロジック

### 5.1 分岐

| 選択 | モード | 出力 |
|------|--------|------|
| 通常 | フル画像 | base 内の「」ブロックをスライドテキストで置換 |
| 人物なし | オーバーレイ | OVERLAY_MODIFIER + base（テキスト置換済み） |

### 5.2 テキスト置換ルール

baseプロンプト内の「...」ブロックを、次の順で置換する：

1. 1個目 → `message`
2. 2個目 → `subMessage`
3. 3個目以降 → `additionalText[0]`, `additionalText[1]`, ...

### 5.3 オーバーレイモード（人物なし）

先頭に以下の文言を付与する：

```
OVERLAY MODE (for video): Remove only the subject/person and the photographed scene. Replace the background with solid color or minimal gradient for easy masking. Keep the same composition: layout structure, text overlay positions and styles, decorative elements, color palette, design style. Identical to the design except the photo is removed.
```

### 5.4 テンプレート未選択時

`minimal-pastel` または `pop-comic` のフォールバックプロンプトを使用。

---

## 6. プロンプトライブラリ

### 6.1 社内管理UI（/library/manage）

- 画像アップロード（1〜複数枚）
- AIが画像を解析し、`prompt_text`, `category`, `memo` を自動生成
- 各画像 → 1テンプレート
- 登録済みテンプレート一覧、モーダルでプロンプト確認・コピー・再生成

### 6.2 デザイン選択（Step4）

- **スライドごと**にデザインを選択
- おすすめ: プロジェクトの marketing_analysis.businessType + スライドの purpose からカテゴリマッチ
- 「別の候補を出す」: その他テンプレートから次の6件を表示

---

## 7. スライド構成生成（AI）

### 7.1 入力

- MarketingAnalysis
- user_supplement（任意）

### 7.2 出力

6〜8枚のスライド。各スライドに以下を生成：

- purpose: 課題提起 / ソリューション / ベネフィット / 社会的証明 / CTA
- message: 20-50文字
- subMessage: 50-120文字
- additionalText: 0-4要素（チェックリスト等）
- emotion: 喚起する感情

### 7.3 ストーリーテリング原則

1. 課題提起（1-2枚）
2. ソリューション提示（2-3枚）
3. ベネフィット（1-2枚）
4. 社会的証明（0-1枚）
5. CTA（1枚）

---

## 8. データベース

### 8.1 テーブル

| テーブル | 説明 |
|----------|------|
| swipe_lp_v3_projects | v3プロジェクト |
| prompt_templates | プロンプトライブラリ |

### 8.2 Storage

- バケット: `images`
- パス: `prompt-templates/{user_id}/{timestamp}-{index}.{ext}`
- RLS: 認証ユーザーが自身のパスのみアップロード可能

### 8.3 マイグレーション

`supabase/apply_v3_and_library.sql` に集約。

---

## 9. 主要ファイル

| パス | 役割 |
|------|------|
| app/swipe-lp/v3/new/page.tsx | Step1: URL入力 |
| app/swipe-lp/v3/[id]/page.tsx | プロジェクトページ（Server） |
| app/swipe-lp/v3/[id]/SwipeLPv3View.tsx | プロジェクト画面（Client） |
| app/swipe-lp/v3/[id]/components/Step2Analysis.tsx | Step2: 分析結果 |
| app/swipe-lp/v3/[id]/components/Step3Supplement.tsx | Step3: 補足情報 |
| app/swipe-lp/v3/[id]/components/Step4SlideEdit.tsx | Step4-5: スライド編集・プロンプト |
| app/swipe-lp/v3/[id]/components/DesignLibraryModal.tsx | デザイン選択モーダル |
| app/actions/swipe-lp-v3.ts | Server Actions |
| app/lib/swipe-lp/gaudi/slides/structure-generator.ts | スライド構成生成 |
| app/lib/swipe-lp/gaudi/design-system/compiler/prompt-compiler.ts | プロンプト生成 |
| app/lib/swipe-lp/gaudi/marketing/analyzer.ts | URLマーケティング分析 |
| app/lib/swipe-lp/gaudi/prompts/image-to-prompt.ts | 画像→プロンプト（ライブラリ用） |
| app/library/manage/page.tsx | ライブラリ管理UI |
| app/actions/library.ts | ライブラリ Server Actions |

---

## 10. 外部連携

- **OpenAI GPT-4o**: マーケティング分析、スライド構成生成、画像→プロンプト
- **Google Vision API**: URL先ページのOCR（マーケティング分析内）
- **Supabase**: DB、Auth、Storage

---

## 11. 出力物

- 生成されたプロンプトは各スライドに表示され、コピー可能
- ユーザーは Flux / DALL-E / NanoBanana 等の画像生成AIへ貼り付けて画像を生成する想定
