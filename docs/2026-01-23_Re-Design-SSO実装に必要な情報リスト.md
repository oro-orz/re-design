# Re:Design SSO実装に必要な情報リスト

**作成日**: 2026年1月23日  
**対象**: Re:Design開発チーム  
**目的**: SSOログイン実装のために必要な情報・リソースの確認

---

## 必須情報

### 1. Firebase Admin SDK設定情報

Re:Design側でFirebase IDトークンを検証するために必要です。

**✅ 既に設定済み**: Re:DesignのVercelにはFirebaseの環境変数が設定済みです。

#### 1.1 設定済み環境変数の確認
- [x] **Firebase環境変数がVercelに設定済み**
  - 以下の環境変数が正しく設定されているか確認してください:
    - `FIREBASE_PROJECT_ID`
    - `FIREBASE_CLIENT_EMAIL`
    - `FIREBASE_PRIVATE_KEY`
  - **確認方法**: Vercelのダッシュボード → プロジェクト設定 → 環境変数

#### 1.2 環境変数の形式確認
- [ ] **`FIREBASE_PRIVATE_KEY`の形式確認**
  - 環境変数に設定する際は、改行文字（`\n`）をエスケープする必要があります
  - 例: `-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n`
  - Vercelの環境変数設定では、改行を含む文字列をそのまま設定できます

#### 1.3 実装時の注意事項
- 環境変数が正しく読み込まれているか確認
- Firebase Admin SDKの初期化が正常に動作するか確認

---

### 2. ユーザー識別方法の確認

#### 2.1 識別パラメータ
- [x] **識別方法**: `companyEmail`（社内メールアドレス）
- [ ] **データベースでの検索方法の確認**
  - `companyEmail`パラメータでユーザーを検索できるか
  - データベースのカラム名（例: `company_email`, `tmg_email`など）

#### 2.2 ユーザーデータの確認
- [ ] **ユーザーテーブルの構造**
  - `companyEmail`でユーザーを一意に識別できるか
  - ユーザーが存在しない場合の処理方法

---

### 3. リダイレクト先パスの確認

#### 3.1 デフォルトリダイレクト先
- [ ] **ログイン成功後のデフォルトリダイレクト先**
  - 仕様書では `/dashboard` を想定していますが、Re:Design側の仕様を確認
  - 例: `/dashboard`, `/`, `/home` など

#### 3.2 リダイレクトパラメータの処理
- [ ] **`redirect`パラメータの処理方法**
  - URLパラメータで指定されたパスにリダイレクトするか
  - セキュリティ対策（外部URLへのリダイレクト防止など）

---

### 4. エラーハンドリングの確認

#### 4.1 エラーケースの処理方法
- [ ] **トークンが無効な場合**
  - エラーページにリダイレクトするか
  - エラーメッセージの表示方法

- [ ] **ユーザーが見つからない場合**
  - エラーページにリダイレクトするか
  - 新規ユーザー登録フローに誘導するか

- [ ] **必須パラメータが不足している場合**
  - エラーページにリダイレクトするか
  - エラーメッセージの内容

---

### 5. セキュリティ設定の確認

#### 5.1 セッション管理
- [ ] **セッションの有効期限**
  - セッションの有効期限（例: 7日間、30日間など）
  - セッションの更新方法

#### 5.2 Cookie設定
- [ ] **セッションCookieの設定**
  - `httpOnly`: true（推奨）
  - `secure`: 本番環境ではtrue（推奨）
  - `sameSite`: 'lax' または 'strict'（推奨）

#### 5.3 CSRF対策
- [ ] **CSRF対策の実装**
  - CSRFトークンの使用有無
  - その他のセキュリティ対策

---

### 6. テスト用情報

#### 6.1 テストアカウント
- [ ] **テスト用の社内メールアドレス**
  - 例: `test@timingood.co.jp`
  - 用途: SSOログインの動作確認

#### 6.2 テスト環境
- [ ] **テスト環境のURL**
  - 例: `https://tmg-re-design-staging.vercel.app`
  - 用途: 実装前の動作確認

---

### 7. 実装完了の確認方法

#### 7.1 動作確認項目
- [ ] **正常系テスト**
  - `firebaseToken`と`companyEmail`が正しく渡された場合、ログインが成功する
  - `redirect`パラメータが指定された場合、指定されたパスにリダイレクトされる
  - セッションCookieが正しく設定される

- [ ] **異常系テスト**
  - 無効な`firebaseToken`の場合、エラーページにリダイレクトされる
  - 存在しない`companyEmail`の場合、エラーページにリダイレクトされる
  - 必須パラメータが不足している場合、エラーページにリダイレクトされる

#### 7.2 統合テスト
- [ ] **TMG Portalからのリダイレクト**
  - TMG PortalからRe:Designへのリダイレクトが正常に動作する
  - ログイン後のリダイレクトが正常に動作する

---

## 推奨情報（任意）

### 8. 開発環境情報

#### 8.1 開発環境のURL
- [ ] **開発環境のURL**（あれば）
  - 用途: 開発中の動作確認

#### 8.2 実装スケジュール
- [ ] **実装完了予定日**
  - 用途: 統合テストのスケジュール調整

---

### 9. 連絡先情報

#### 9.1 開発チームの連絡先
- [ ] **開発チームの連絡先**
  - メールアドレス
  - Slackチャンネル（あれば）
  - その他の連絡手段

#### 9.2 質問・問題報告の方法
- [ ] **質問・問題報告の方法**
  - どのような方法で質問・問題報告を行うか

---

## 情報提供の優先順位

### 最優先（実装開始に必須）
1. ✅ Firebase Admin SDK設定情報（**既にVercelに設定済み**）
2. ✅ ユーザー識別方法の確認（`companyEmail`で検索できるか）
3. ✅ リダイレクト先パスの確認（デフォルトパス）

### 高優先度（実装中に必要）
4. エラーハンドリングの確認
5. セキュリティ設定の確認
6. テスト用アカウント情報

### 中優先度（統合テスト前に必要）
7. 実装完了の確認方法
8. テスト環境のURL

### 低優先度（任意）
9. 開発環境情報
10. 実装スケジュール
11. 連絡先情報

---

## 情報提供の形式

### 推奨形式
- **メール**: 機密情報は暗号化して送信、または別の安全な方法で共有
- **ドキュメント**: Markdown、Google Docs、Confluenceなど
- **共有フォルダ**: Google Drive、Dropboxなど（アクセス権限を適切に設定）

### 機密情報の取り扱い
- **サービスアカウントキー**: 暗号化して送信、または1Password、LastPassなどのパスワード管理ツールを使用
- **テストアカウント情報**: 本番環境の情報と区別して管理

---

## 参考資料

### 提供済みドキュメント
- `docs/2026-01-23_Re-Design-SSOログイン実装仕様書.md`
  - SSOログインの実装仕様書
  - 実装例、エラーハンドリング、テスト項目を含む

### 既存実装の参考
- SkillMap for PM/PS
- PeekBoard
- スワイパー

これらのアプリは既にSSOログインを実装済みです。実装方法の参考にしてください。

---

## 質問・確認事項

### 実装に関する質問
1. Re:Design側の技術スタック（Next.js、その他のフレームワークなど）
2. 既存の認証システム（セッション管理、JWTなど）
3. データベースの種類（PostgreSQL、MySQL、MongoDBなど）

### 仕様に関する確認
1. ログイン後のリダイレクト先のデフォルトパス
2. エラー時のリダイレクト先
3. セッションの有効期限

---

**最終更新日**: 2026年1月23日  
**バージョン**: 1.0
